# Anti-AI Detection System for Human-Like Review Generation

## Overview

This document describes the implementation of an anti-AI detection system designed to generate Google Maps reviews that cannot be identified as AI-generated by Google or other detection algorithms.

## Problem Statement

AI-generated reviews often exhibit detectable patterns:
- Perfect grammar and punctuation
- Repetitive sentence structures (Subject-Verb-Object)
- Generic superlatives ("amazing", "excellent", "best ever")
- Marketing language ("highly recommend", "5 stars")
- Overly balanced reviews (always pros and cons)
- Formal tone throughout
- No colloquialisms or informal expressions
- Equal sentence lengths
- No personal details or specific experiences

## Solution Architecture

### Core File: `src/lib/human-review-generator.ts`

This module implements the anti-AI detection system with the following components:

### 1. Writing Style Variations

Six distinct writing styles that mimic real human review patterns:

| Style | Sentences | Words | Characteristics |
|-------|-----------|-------|-----------------|
| `casual_short` | 1-2 | 5-15 | Quick, informal reviews |
| `story_teller` | 2-4 | 15-30 | Narrative style with context |
| `matter_of_fact` | 2-3 | 8-15 | Direct, minimal punctuation |
| `enthusiastic` | 1-3 | 10-20 | Very casual, uses "!" |
| `detailed_reviewer` | 3-5 | 20-40 | Thorough with structure |
| `minimalist` | 1 | 2-8 | Ultra-short ("Bien.", "Nickel.") |

### 2. French Authenticity Markers

**Sentence Starters:**
- Positive: "Franchement,", "Honnêtement,", "J'avoue,", "En vrai,", "Perso,"
- Neutral: "Alors,", "Bon ben,", "Voilà,", "Bref,", "Du coup,"
- Experience: "On a fait appel à eux", "Mon voisin m'avait recommandé"

**Informal Expressions:**
- "super", "top", "nickel", "impec", "tip top", "au top"
- "pas mal du tout", "rien à dire"

**Natural Hedging (humans don't speak in absolutes):**
- "plutôt", "assez", "franchement", "carrément"
- "je trouve que", "perso", "pour moi"

**Time References:**
- "l'autre jour", "la semaine dernière", "y a pas longtemps"
- "il y a quelques semaines", "le mois dernier"

**Personal Touches:**
- "ma femme/mon mari", "mes parents", "mon voisin"
- "un collègue", "ma belle-mère", "notre proprio"

### 3. Business-Specific Details

The system generates relevant details based on business type:

**Roofing:**
- "fuite au niveau du toit", "tuiles cassées après la tempête"
- "gouttière bouchée", "problème d'infiltration"

**Plumbing:**
- "fuite sous l'évier", "chauffe-eau en panne"
- "toilettes bouchées", "robinet qui goutte"

**Electrical:**
- "panne de courant", "tableau électrique"
- "prises qui sautaient", "mise aux normes"

**Restaurant:**
- "midi en semaine", "dîner en amoureux"
- "menu du jour", "plat du chef"

### 4. Ending Variations

Natural review endings:
- Recommendation: "Je recommande.", "Allez-y les yeux fermés.", "Je garde le contact."
- Satisfaction: "Nickel.", "Parfait.", "Rien à redire."
- Neutral: "Merci.", "Voilà.", or no ending at all

## Key Functions

### `getHumanLikePrompt(config: HumanPromptConfig): string`

Main function that randomly selects one of three prompt strategies:
- **15%** - Ultra minimal (1-2 sentences max)
- **20%** - Story style (narrative with context)
- **65%** - Standard with random writing style

### `buildHumanLikePrompt(config: HumanPromptConfig): string`

Builds the master prompt with:
1. Business context (name, type, category)
2. Specific detail relevant to business type
3. Random writing style configuration
4. Critical anti-AI rules
5. Example reviews for style reference

### `postProcessReview(text: string): string`

Post-processing to add authenticity:
1. Remove surrounding quotes
2. Remove excessive punctuation
3. Occasional minor "imperfections" (5% chance)

## Anti-AI Detection Rules (Embedded in Prompts)

The system explicitly instructs the AI to avoid:

1. **Marketing words:** "excellent", "exceptionnel", "hautement recommandé", "5 étoiles"
2. **Perfect structure:** Real people write naturally, not formally
3. **Excessive punctuation:** No "!!!!" or "..."
4. **Commercial phrases:** "je recommande vivement", "n'hésitez pas à"
5. **Uniform sentence lengths:** Vary structure and length
6. **Always developing:** Sometimes one sentence is enough

## Integration with Dual Route

The system is integrated in `/api/reviews/generate/dual/route.ts`:

```typescript
import {
    getHumanLikePrompt,
    postProcessReview,
    HumanPromptConfig,
} from "@/lib/human-review-generator";

// Build config
const humanConfig: HumanPromptConfig = {
    businessName: profile.businessName,
    businessType: businessTypeDesc,
    businessCategory: businessCategory,
    userHint: userHint,
    templateInstruction: template?.promptInstruction,
};

// Generate prompt
const prompt = getHumanLikePrompt(humanConfig);

// Post-process result
french = postProcessReview(french);
```

## Example Outputs

**Minimalist Style:**
```
Nickel, rapide et efficace.
```

**Matter of Fact:**
```
Intervention rapide. Travail propre. Prix correct.
```

**Story Teller:**
```
Suite à une fuite la semaine dernière, j'ai fait appel à eux. Mon voisin m'avait recommandé. Résultat nickel, je garde le numéro.
```

**Casual Short:**
```
Super service, équipe sympa. Je recommande.
```

## Temperature Settings

The AI generation uses randomized temperature for natural variation:
- Base: 0.85
- Random addition: 0-0.1
- Final range: 0.85-0.95

This produces slightly different outputs each time while maintaining coherence.

## Category Mapping

Business categories are mapped to context categories for relevant content:

| Business Type | Context Category |
|---------------|-----------------|
| Roofing, Plumbing, Electric, HVAC, etc. | SERVICE |
| Restaurant, Cafe, Pizza, Bakery, etc. | RESTAURANT |
| Shop, Store, Retail, Boutique | RETAIL |
| Doctor, Dentist, Clinic, Hospital | MEDICAL |
| Everything else | GENERAL |

## Maintenance

### Adding New Business Types

1. Add specific details in `SPECIFIC_DETAILS` object
2. Update `getSpecificDetail()` function for matching
3. Update `mapToContextCategory()` if needed

### Adding New Writing Styles

1. Add to `WritingStyle` type
2. Add configuration in `STYLE_CONFIGS`
3. Update `getRandomStyle()` with weighting

### Adding New Expressions

1. Add to appropriate category in:
   - `SENTENCE_STARTERS`
   - `AUTHENTICITY_MARKERS`
   - `ENDINGS`

## Testing

To test the system:
1. Generate multiple reviews for the same business
2. Verify each output is unique
3. Check for absence of AI markers
4. Validate business relevance
5. Confirm French authenticity

---

*Last updated: February 2026*
